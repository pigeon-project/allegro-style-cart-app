# Observability Alert Configuration
# These thresholds should be configured in your monitoring/alerting system

observability:
  alerts:
    # Elevated 5xx error rate
    error-rate-5xx:
      threshold: 0.05  # 5% of requests
      window: 5m
      description: "Alert when 5xx error rate exceeds 5% over 5 minutes"
    
    # Read endpoint latency breach (p95)
    latency-read-p95:
      threshold: 250ms
      window: 5m
      endpoints:
        - GET /api/cart
      description: "Alert when read endpoint p95 latency exceeds 250ms"
    
    # Write endpoint latency breach (p95)
    latency-write-p95:
      threshold: 400ms
      window: 5m
      endpoints:
        - POST /api/cart/items
        - PUT /api/cart/items/*
        - DELETE /api/cart/items
        - DELETE /api/cart/items/*
      description: "Alert when write endpoint p95 latency exceeds 400ms"
    
    # p99 latency breach (more sensitive)
    latency-p99:
      threshold: 1000ms
      window: 5m
      description: "Alert when any endpoint p99 latency exceeds 1000ms"
    
    # Abnormal error rate (any 4xx/5xx)
    error-rate-abnormal:
      threshold: 0.10  # 10% of requests
      window: 5m
      description: "Alert when overall error rate exceeds 10% over 5 minutes"
    
    # Memory saturation
    memory-saturation:
      threshold: 0.90  # 90% of max heap
      window: 5m
      description: "Alert when JVM memory usage exceeds 90%"
    
    # CPU saturation
    cpu-saturation:
      threshold: 0.80  # 80% CPU usage
      window: 5m
      description: "Alert when system CPU usage exceeds 80%"
    
    # Authentication failure spike
    auth-failure-spike:
      threshold: 10
      window: 1m
      description: "Alert when authentication failures exceed 10 per minute"

  # Service Level Objectives (SLOs)
  slo:
    availability: 99.9  # 99.9% uptime per month
    read-latency-p95: 250ms
    write-latency-p95: 400ms
    error-budget: 0.1  # 0.1% error budget

  # Metrics to track
  metrics:
    request-rate:
      enabled: true
      description: "Requests per second (RPS)"
    
    latency:
      enabled: true
      percentiles: [0.5, 0.9, 0.95, 0.99]
      description: "Request latency percentiles"
    
    error-rate:
      enabled: true
      by-status-class: true
      description: "Error rate by 4xx/5xx status codes"
    
    saturation:
      enabled: true
      metrics:
        - jvm.memory.used
        - jvm.memory.max
        - system.cpu.usage
        - process.cpu.usage
      description: "System saturation metrics"
